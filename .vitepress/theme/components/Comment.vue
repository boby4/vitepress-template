<script setup>
import { onMounted, ref, watch, nextTick } from 'vue'
import { useData } from 'vitepress'
const utterancesRef = ref()
const { theme, isDark } = useData()
onMounted(() => {
    nextTick(() => {
        let { repo, issueTerm = 'pathname' } = theme.value.comment
        if (repo) {
            let utterances = document.createElement('script')
            utterances.async = true
            utterances.setAttribute('src', 'https://utteranc.es/client.js')
            utterances.setAttribute('repo', repo)
            utterances.setAttribute('issue-term', issueTerm)
            // utterances.setAttribute('theme', isDark.value ? 'github-dark' : 'github-light')
            utterances.setAttribute('theme', 'github-light')
            utterances.setAttribute('crossorigin', 'anonymous')
            utterancesRef.value.appendChild(utterances)
        }
        //hack method to change utterances theme when change site theme
        // watch(isDark, (newVal, oldVal) => {
        //     if (newVal !== oldVal) window.location.replace(window.location?.href)
        // })
    })
})
</script>

<template>
<div class="post_comments">
    <div class="line">
        <div class="line_name">评论</div>
    </div>
    <div ref="utterancesRef"></div>
</div>
</template>

<style>
/*global  style*/
.utterances {
    max-width: inherit !important;
}
.post_comments {
    background-color: #FFF;
    padding: 1.25rem;
    margin-top: 1.4rem;
}
.post_comments .line {
    padding-bottom: 0.3rem;
    border-bottom: 1px solid #eaecef;
    position: relative;
    margin-bottom: 1.2rem;
}
.post_comments .line_name {
    color: #666;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.2rem;
}
</style>
